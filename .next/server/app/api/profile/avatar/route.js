(()=>{var e={};e.id=995,e.ids=[995],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},51416:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>R,routeModule:()=>x,serverHooks:()=>E,workAsyncStorage:()=>g,workUnitAsyncStorage:()=>v});var s={};t.r(s),t.d(s,{POST:()=>m,runtime:()=>d});var o=t(96559),a=t(48088),n=t(37719),i=t(32190);let u=require("crypto"),p=require("buffer");var l=t(83008);let c=null,d="nodejs",f=process.env.NEXT_PUBLIC_SUPABASE_AVATAR_BUCKET||"avatars";async function m(e){try{let r=await e.formData(),t=r.get("file"),s=r.get("userId");if(!(t instanceof File))return i.NextResponse.json({error:"Archivo inv\xe1lido"},{status:400});if("string"!=typeof s||0===s.length)return i.NextResponse.json({error:"Usuario inv\xe1lido"},{status:400});if(t.size>2097152)return i.NextResponse.json({error:"La imagen debe pesar menos de 2 MB"},{status:400});if(!t.type.startsWith("image/"))return i.NextResponse.json({error:"Solo se permiten im\xe1genes"},{status:400});let o=function(){if(c)return c;let e=process.env.NEXT_PUBLIC_SUPABASE_URL,r=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e||!r)throw Error("Faltan NEXT_PUBLIC_SUPABASE_URL o SUPABASE_SERVICE_ROLE_KEY en el entorno");return c=(0,l.UU)(e,r)}(),{error:a}=await o.storage.getBucket(f);if(a&&a.message?.toLowerCase().includes("not found")){let{error:e}=await o.storage.createBucket(f,{public:!0,fileSizeLimit:"2097152",allowedMimeTypes:["image/jpeg","image/png","image/webp"]});if(e)return console.error("Error al crear bucket de avatars",e),i.NextResponse.json({error:"No se pudo preparar el almacenamiento"},{status:500})}else if(a)return console.error("Error al verificar bucket de avatars",a),i.NextResponse.json({error:"No se pudo acceder al almacenamiento"},{status:500});let n=await t.arrayBuffer(),d=p.Buffer.from(n),m=t.name.split(".").pop()?.toLowerCase()||"png",x=`${s}/${(0,u.randomUUID)()}.${m}`,{error:g}=await o.storage.from(f).upload(x,d,{cacheControl:"3600",upsert:!0,contentType:t.type});if(g)return console.error("Error al subir avatar",g),i.NextResponse.json({error:"No se pudo subir la imagen"},{status:500});let{data:{publicUrl:v}}=o.storage.from(f).getPublicUrl(x);return i.NextResponse.json({url:v})}catch(e){return console.error("Error inesperado subiendo avatar",e),i.NextResponse.json({error:"Error interno"},{status:500})}}let x=new o.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/profile/avatar/route",pathname:"/api/profile/avatar",filename:"route",bundlePath:"app/api/profile/avatar/route"},resolvedPagePath:"/Users/leandroebel/Downloads/DCI/SMNew/app/api/profile/avatar/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:g,workUnitAsyncStorage:v,serverHooks:E}=x;function R(){return(0,n.patchFetch)({workAsyncStorage:g,workUnitAsyncStorage:v})}},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},96487:()=>{}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[447,8,580],()=>t(51416));module.exports=s})();