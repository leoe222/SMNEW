(()=>{var e={};e.id=999,e.ids=[999],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},28086:(e,t,r)=>{"use strict";r.d(t,{U:()=>i});var s=r(34386),n=r(44999);async function i(){let e=await (0,n.UL)();return(0,s.createServerClient)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:r,options:s})=>e.set(t,r,s))}catch{}}}})}},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},45926:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>m,routeModule:()=>c,serverHooks:()=>f,workAsyncStorage:()=>p,workUnitAsyncStorage:()=>d});var s={};r.r(s),r.d(s,{POST:()=>l});var n=r(96559),i=r(48088),a=r(37719),o=r(32190),u=r(28086);async function l(e){try{let t=await (0,u.U)(),{data:{user:r}}=await t.auth.getUser();if(!r)return o.NextResponse.json({error:"Unauthenticated"},{status:401});let{title:s,numericLevel:n,justification:i,skillId:a}=await e.json()||{},l="string"==typeof a&&a.length>0,c="string"==typeof s&&s.length>0;if(!l&&!c||!Number.isFinite(n))return o.NextResponse.json({error:"Invalid payload. Provide skillId or title and a numericLevel (0-5)."},{status:400});let p=null;if(l)p=a;else if(c){let e=e=>e.normalize("NFD").replace(/\p{Diacritic}/gu,"").toLowerCase().trim(),r=e(s),{data:n,error:i}=await t.from("skills").select("id, name");if(i)return o.NextResponse.json({error:i.message},{status:500});let a=(n||[]).find(t=>e(t.name)===r);p=a?.id??null}if(!p)return o.NextResponse.json({error:"Skill not found. Please ensure the skill exists in the database."},{status:404});let d=Math.max(0,Math.min(5,Math.round(Number(n)))),f={user_id:r.id,skill_id:p,level:d<=1?"basic":d<=3?"intermediate":"advanced",justification:i||"Sin comentario",status:"pending",approved_at:null,approved_by:null,updated_at:new Date().toISOString()},m={...f,numeric_level:d},{error:v}=await t.from("skill_assessments").upsert(m,{onConflict:"user_id,skill_id"});if(v&&(/numeric_level/i.test(v.message||"")||/column\s+"?level"?.*integer|invalid input syntax for type integer|type integer/i.test(v.message||""))){let e={...f,level:d},{error:r}=await t.from("skill_assessments").upsert(e,{onConflict:"user_id,skill_id"});if(!r)return o.NextResponse.json({success:!0,note:"Saved using integer level schema."});v=r}if(v&&/column\s+"?numeric_level"? does not exist|unknown column|does not exist/i.test(v.message||"")){let e={...f},{error:r}=await t.from("skill_assessments").upsert(e,{onConflict:"user_id,skill_id"});if(!r)return o.NextResponse.json({success:!0,note:"Saved using legacy text level schema."});v=r}if(v)return o.NextResponse.json({success:!1,error:v.message},{status:500});return o.NextResponse.json({success:!0})}catch(e){return o.NextResponse.json({error:e?.message||"Server error"},{status:500})}}let c=new n.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/assessments/route",pathname:"/api/assessments",filename:"route",bundlePath:"app/api/assessments/route"},resolvedPagePath:"/Users/leandroebel/Downloads/DCI/SMNew/app/api/assessments/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:p,workUnitAsyncStorage:d,serverHooks:f}=c;function m(){return(0,a.patchFetch)({workAsyncStorage:p,workUnitAsyncStorage:d})}},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},76926:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"createDedupedByCallsiteServerErrorLoggerDev",{enumerable:!0,get:function(){return u}});let s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=n(t);if(r&&r.has(e))return r.get(e);var s={__proto__:null},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(s,a,o):s[a]=e[a]}return s.default=e,r&&r.set(e,s),s}(r(61120));function n(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(n=function(e){return e?r:t})(e)}let i={current:null},a="function"==typeof s.cache?s.cache:e=>e,o=console.warn;function u(e){return function(...t){o(e(...t))}}a(e=>{try{o(i.current)}finally{i.current=null}})},78335:()=>{},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},96487:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[447,8,410,580],()=>r(45926));module.exports=s})();