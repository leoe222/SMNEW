(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[636],{20343:(e,r,a)=>{"use strict";a.d(r,{default:()=>p});var s=a(95155),l=a(6874),t=a.n(l),i=a(12115),d=a(66766),n=a(97168),o=a(69663),c=a(83254),u=a(87358),m=a(56671),x=a(57340),h=a(25273),f=a(71007),v=a(34835);function p(e){let{user:r}=e,[a,l]=(0,i.useState)(""),[p,b]=(0,i.useState)(!1);(0,i.useLayoutEffect)(()=>{l(window.location.pathname),b(!0)},[]);let g=async()=>{try{let e=(0,c.createBrowserClient)(u.env.NEXT_PUBLIC_SUPABASE_URL,u.env.NEXT_PUBLIC_SUPABASE_ANON_KEY),{error:r}=await e.auth.signOut();r?m.oR.error(r.message||"Error al cerrar sesi\xf3n"):(m.oR.success("Sesi\xf3n cerrada exitosamente"),window.location.href="/login")}catch(e){console.error("Error al cerrar sesi\xf3n:",e),m.oR.error("Error al cerrar sesi\xf3n")}},j=(null==r?void 0:r.firstName)||(null==r?void 0:r.first_name)||((null==r?void 0:r.name)?r.name.split(" ")[0]:"")||"",N=(null==r?void 0:r.lastName)||(null==r?void 0:r.last_name)||((null==r?void 0:r.name)?r.name.split(" ").slice(1).join(" "):"")||"",y=[j,N].filter(Boolean).join(" "),w=(null==r?void 0:r.avatar_url)||(null==r?void 0:r.avatarUrl)||void 0,k=(e,a)=>{let s=(null==e?void 0:e.charAt(0))||"",l=(null==a?void 0:a.charAt(0))||"";return"".concat(s).concat(l).toUpperCase()||((null==r?void 0:r.email)?r.email.charAt(0).toUpperCase():"")},E=e=>{switch(e){case"designer":return"Product Designer";case"leader":return"L\xedder";case"head_chapter":return"Head Chapter";case"admin":return"Administrador";default:return e||"Usuario"}},_=e=>!!p&&(null==a?void 0:a.startsWith(e));return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("aside",{className:"fixed left-0 top-0 w-64 h-screen bg-white border-r px-8 py-10 flex flex-col items-center z-50",children:[(0,s.jsxs)("div",{className:"flex flex-col items-center mb-6",children:[(0,s.jsx)("div",{className:"w-36 h-auto",children:(0,s.jsx)(d.default,{src:"/images/latam-logo.svg",alt:"LATAM Logo",width:144,height:40,priority:!0})}),(0,s.jsx)("div",{className:"mt-4 text-2xl font-extrabold text-gray-300 tracking-tight",children:"SkillMatrix"})]}),(0,s.jsxs)("div",{className:"flex flex-col items-center mb-6",children:[(0,s.jsx)("div",{className:"rounded-full p-1 bg-gray-200",children:(0,s.jsxs)(o.eu,{className:"h-28 w-28 ring-4 ring-white shadow-sm",children:[w&&(0,s.jsx)(o.BK,{src:w,alt:"Avatar",referrerPolicy:"no-referrer"}),(0,s.jsx)(o.q5,{className:"text-lg",children:k(j,N)})]})}),(0,s.jsxs)("div",{className:"mt-4 text-center",children:[(0,s.jsx)("div",{className:"text-base font-semibold text-gray-900",children:y||"Usuario"}),(0,s.jsx)("div",{className:"text-sm text-gray-500",children:E(null==r?void 0:r.role)})]})]}),(0,s.jsx)("nav",{className:"w-full flex-1",children:(0,s.jsxs)("ul",{className:"w-full space-y-4 mt-6",children:[(0,s.jsx)("li",{className:"w-full",children:(0,s.jsx)(n.$,{asChild:!0,variant:"ghost",className:"w-full justify-start gap-4 px-4 py-3 ".concat(_("/dashboard")?"bg-gray-50 rounded-md":""),children:(0,s.jsxs)(t(),{href:"/dashboard",children:[(0,s.jsx)(x.A,{className:"w-5 h-5"}),(0,s.jsx)("span",{className:"text-base font-medium",children:"Dashboard"})]})})}),(0,s.jsx)("li",{className:"w-full",children:(0,s.jsx)(n.$,{asChild:!0,variant:"ghost",className:"w-full justify-start gap-4 px-4 py-3 ".concat(_("/auto-evaluaciones")?"bg-gray-50 rounded-md":""),children:(0,s.jsxs)(t(),{href:"/auto-evaluaciones",children:[(0,s.jsx)(h.A,{className:"w-5 h-5"}),(0,s.jsx)("span",{className:"text-base font-medium",children:"Auto evaluaciones"})]})})}),(0,s.jsx)("li",{className:"w-full",children:(0,s.jsx)(n.$,{asChild:!0,variant:"ghost",className:"w-full justify-start gap-4 px-4 py-3 ".concat(_("/profile")?"bg-gray-50 rounded-md":""),children:(0,s.jsxs)(t(),{href:"/profile",children:[(0,s.jsx)(f.A,{className:"w-5 h-5"}),(0,s.jsx)("span",{className:"text-base font-medium",children:"Mi Perfil"})]})})})]})}),(0,s.jsx)("div",{className:"w-full border-t mt-4 mb-4"}),(0,s.jsx)("div",{className:"w-full",children:(0,s.jsxs)(n.$,{variant:"outline",className:"w-full justify-start gap-4 px-4 py-3 text-red-600",onClick:g,children:[(0,s.jsx)(v.A,{className:"w-5 h-5"}),(0,s.jsx)("span",{className:"text-base",children:"Cerrar sesi\xf3n"})]})})]}),(0,s.jsx)("div",{className:"md:hidden fixed bottom-4 left-4 right-4 z-50",children:(0,s.jsx)("div",{className:"bg-white border rounded-lg shadow-sm px-3 py-2",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsxs)(o.eu,{className:"h-8 w-8",children:[w&&(0,s.jsx)(o.BK,{src:w,alt:"Avatar",referrerPolicy:"no-referrer"}),(0,s.jsx)(o.q5,{className:"text-xs",children:k(j,N)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm font-medium text-gray-900",children:j||"Usuario"}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:E(null==r?void 0:r.role)})]})]}),(0,s.jsx)("div",{children:(0,s.jsx)(n.$,{variant:"outline",className:"text-red-600",onClick:g,children:"Cerrar sesi\xf3n"})})]})})})]})}},29365:(e,r,a)=>{Promise.resolve().then(a.bind(a,71615)),Promise.resolve().then(a.bind(a,20343))},53905:(e,r,a)=>{"use strict";a.d(r,{Fk:()=>i,X5:()=>l,zK:()=>t});var s=a(68309);let l=s.Ik({email:s.Yj().min(1,"El correo electr\xf3nico es requerido").email("El formato del correo electr\xf3nico no es v\xe1lido"),password:s.Yj().min(1,"La contrase\xf1a es requerida").min(6,"La contrase\xf1a debe tener al menos 6 caracteres")}),t=s.Ik({firstName:s.Yj().min(1,"El nombre es requerido").min(2,"El nombre debe tener al menos 2 caracteres"),lastName:s.Yj().min(1,"El apellido es requerido").min(2,"El apellido debe tener al menos 2 caracteres"),email:s.Yj().min(1,"El correo electr\xf3nico es requerido").email("El formato del correo electr\xf3nico no es v\xe1lido"),password:s.Yj().min(1,"La contrase\xf1a es requerida").min(6,"La contrase\xf1a debe tener al menos 6 caracteres"),confirmPassword:s.Yj().min(1,"Confirmar contrase\xf1a es requerido"),role:s.k5(["designer","leader","head_chapter"])}).refine(e=>e.password===e.confirmPassword,{message:"Las contrase\xf1as no coinciden",path:["confirmPassword"]}),i=s.Ik({firstName:s.Yj().min(2,"El nombre debe tener al menos 2 caracteres"),lastName:s.Yj().min(2,"El apellido debe tener al menos 2 caracteres"),leaderId:s.Yj().optional(),squad:s.Yj().min(1,"El squad es requerido").optional(),avatarUrl:s.Yj().url("La URL del avatar no es v\xe1lida").or(s.eu("")).optional()})},53999:(e,r,a)=>{"use strict";a.d(r,{cn:()=>t});var s=a(52596),l=a(39688);function t(){for(var e=arguments.length,r=Array(e),a=0;a<e;a++)r[a]=arguments[a];return(0,l.QP)((0,s.$)(r))}},69663:(e,r,a)=>{"use strict";a.d(r,{BK:()=>d,eu:()=>i,q5:()=>n});var s=a(95155);a(12115);var l=a(54011),t=a(53999);function i(e){let{className:r,...a}=e;return(0,s.jsx)(l.bL,{"data-slot":"avatar",className:(0,t.cn)("relative flex size-8 shrink-0 overflow-hidden rounded-full",r),...a})}function d(e){let{className:r,...a}=e;return(0,s.jsx)(l._V,{"data-slot":"avatar-image",className:(0,t.cn)("aspect-square size-full object-cover",r),...a})}function n(e){let{className:r,children:a,...i}=e;return(0,s.jsx)(l.H4,{"data-slot":"avatar-fallback",className:(0,t.cn)("bg-muted flex size-full items-center justify-center rounded-full",r),...i,children:a})}},71615:(e,r,a)=>{"use strict";a.d(r,{default:()=>f});var s=a(95155),l=a(12115),t=a(35695),i=a(97168),d=a(62177),n=a(90221),o=a(56671),c=a(34477);let u=(0,c.createServerReference)("40f2d7c0c45f848fe9c39f64d8de00dce8bf16b0e5",c.callServer,void 0,c.findSourceMapURL,"getLeadersByRole"),m=(0,c.createServerReference)("400bc54be1d44cbb4b0dff4ddb5e073085f78c84a9",c.callServer,void 0,c.findSourceMapURL,"updateProfile");var x=a(53905),h=a(69663);function f(e){let{initialData:r}=e,a=(0,t.useRouter)(),[c,f]=(0,l.useState)([]),[v,p]=(0,l.useState)((null==r?void 0:r.avatar_url)||""),[b,g]=(0,l.useState)(!1),j=(0,l.useRef)(null),{register:N,handleSubmit:y,formState:{errors:w,isSubmitting:k,isDirty:E},setValue:_,watch:C}=(0,d.mN)({resolver:(0,n.u)(x.Fk),defaultValues:{firstName:(null==r?void 0:r.first_name)||"",lastName:(null==r?void 0:r.last_name)||"",leaderId:(null==r?void 0:r.leader_id)||"none",squad:(null==r?void 0:r.squad)||"",avatarUrl:(null==r?void 0:r.avatar_url)||""}}),q=C("leaderId"),A=C("firstName"),S=C("lastName");(0,l.useEffect)(()=>{(async()=>{try{let e=await u(r.role);f(e),(null==r?void 0:r.leader_id)&&_("leaderId",r.leader_id)}catch(e){console.error("Error al cargar l\xedderes:",e),o.oR.error("Error al cargar los l\xedderes disponibles")}})()},[r.role,r.leader_id,_]);let P=(0,l.useCallback)(async e=>{let a=new FormData;a.append("file",e),a.append("userId",r.id);let s=await fetch("/api/profile/avatar",{method:"POST",body:a});if(!s.ok){let e=await s.json().catch(()=>({}));throw Error((null==e?void 0:e.error)||"No se pudo subir la imagen")}let l=await s.json();if(!(null==l?void 0:l.url))throw Error("Respuesta inv\xe1lida del servidor");return l.url},[r.id]),R=async e=>{var r;let a=null===(r=e.target.files)||void 0===r?void 0:r[0];if(a){if(!a.type.startsWith("image/")){o.oR.error("Por favor selecciona una imagen v\xe1lida");return}if(a.size>2097152){o.oR.error("La imagen debe pesar menos de 2 MB");return}g(!0);try{let e=await P(a);p(e),_("avatarUrl",e,{shouldDirty:!0}),o.oR.success("Foto de perfil actualizada")}catch(r){console.error("Error inesperado al subir avatar:",r);let e=r instanceof Error?r.message:"Ocurri\xf3 un error al subir la imagen";o.oR.error(e)}finally{g(!1),j.current&&(j.current.value="")}}},U=async e=>{try{let r=await m(e);r.success?(o.oR.success("Perfil actualizado exitosamente"),a.refresh()):o.oR.error(r.error||"Error al actualizar el perfil")}catch(e){console.error("Error al actualizar perfil:",e),o.oR.error("Error al actualizar el perfil")}};return(0,s.jsxs)("form",{onSubmit:y(U),className:"space-y-6",children:[(0,s.jsx)("input",{type:"hidden",...N("avatarUrl")}),(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("div",{className:"relative",children:(0,s.jsxs)(h.eu,{className:"h-20 w-20 border-2 border-gray-100 shadow-sm",children:[v&&(0,s.jsx)(h.BK,{src:v,alt:"Foto de perfil",referrerPolicy:"no-referrer"}),(0,s.jsx)(h.q5,{className:"text-lg font-medium text-gray-600 bg-gray-100",children:((e,r,a)=>{var s,l;let t=null==e?void 0:null===(s=e.trim())||void 0===s?void 0:s.charAt(0),i=null==r?void 0:null===(l=r.trim())||void 0===l?void 0:l.charAt(0),d="".concat(t||"").concat(i||"");return d?d.toUpperCase():a?a.charAt(0).toUpperCase():"?"})(A||(null==r?void 0:r.first_name)||"",S||(null==r?void 0:r.last_name)||"",null==r?void 0:r.email)})]})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Foto de perfil"}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Formatos PNG o JPG. Tama\xf1o m\xe1ximo 2 MB."}),(0,s.jsxs)("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[(0,s.jsx)(i.$,{type:"button",variant:"outline",onClick:()=>{var e;return null===(e=j.current)||void 0===e?void 0:e.click()},disabled:b,children:b?"Subiendo...":v?"Cambiar foto":"Subir foto"}),v&&!b&&(0,s.jsx)(i.$,{type:"button",variant:"ghost",onClick:()=>{p(""),_("avatarUrl","",{shouldDirty:!0})},className:"text-sm text-red-600",children:"Quitar foto"})]})]})]}),(0,s.jsx)("input",{ref:j,type:"file",accept:"image/png,image/jpeg,image/jpg",className:"hidden",onChange:R})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"firstName",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre"}),(0,s.jsx)("input",{id:"firstName",placeholder:"Tu nombre",...N("firstName"),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#003366] focus:border-[#003366]"}),w.firstName&&(0,s.jsx)("p",{className:"text-destructive text-sm mt-1",children:w.firstName.message})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"lastName",className:"block text-sm font-medium text-gray-700 mb-1",children:"Apellido"}),(0,s.jsx)("input",{id:"lastName",placeholder:"Tu apellido",...N("lastName"),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#003366] focus:border-[#003366]"}),w.lastName&&(0,s.jsx)("p",{className:"text-destructive text-sm mt-1",children:w.lastName.message})]})]}),(0,s.jsxs)("div",{className:"bg-[#003366]/10 border border-[#003366]/20 rounded-lg p-4",children:[(0,s.jsxs)("p",{className:"text-sm text-[#003366]",children:[(0,s.jsx)("strong",{children:"Email:"})," ",null==r?void 0:r.email]}),(0,s.jsx)("p",{className:"text-xs text-[#003366]/70 mt-1",children:"El email no se puede modificar desde aqu\xed. Contacta al administrador si necesitas cambiarlo."})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"squad",className:"block text-sm font-medium text-gray-700 mb-1",children:"Squad"}),(0,s.jsx)("input",{id:"squad",placeholder:"Ej: Alpha, Delta, Transversal",...N("squad"),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#003366] focus:border-[#003366]"}),w.squad&&(0,s.jsx)("p",{className:"text-destructive text-sm mt-1",children:w.squad.message}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Puedes cambiar tu squad libremente."})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"leaderId",className:"block text-sm font-medium text-gray-700 mb-1",children:(null==r?void 0:r.role)==="designer"?"L\xedder":(null==r?void 0:r.role)==="leader"?"Head Chapter":(null==r?void 0:r.role)==="head_chapter"?"Administrador":"Supervisor"}),(0,s.jsxs)("select",{id:"leaderId",...N("leaderId"),value:q,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#003366] focus:border-[#003366]",children:[(0,s.jsx)("option",{value:"none",children:"Sin l\xedder asignado"}),c.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id))]}),w.leaderId&&(0,s.jsx)("p",{className:"text-destructive text-sm mt-1",children:w.leaderId.message})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,s.jsx)(i.$,{type:"button",variant:"outline",onClick:()=>a.back(),disabled:k,children:"Cancelar"}),(0,s.jsx)(i.$,{type:"submit",disabled:k||!E,className:E?"":"opacity-50 cursor-not-allowed",children:k?"Guardando...":"Guardar Cambios"})]})]})}},97168:(e,r,a)=>{"use strict";a.d(r,{$:()=>n});var s=a(95155);a(12115);var l=a(99708),t=a(74466),i=a(53999);let d=(0,t.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function n(e){let{className:r,variant:a,size:t,asChild:n=!1,...o}=e,c=n?l.DX:"button";return(0,s.jsx)(c,{"data-slot":"button",className:(0,i.cn)(d({variant:a,size:t,className:r})),...o})}}},e=>{var r=r=>e(e.s=r);e.O(0,[671,874,352,580,419,441,684,358],()=>r(29365)),_N_E=e.O()}]);